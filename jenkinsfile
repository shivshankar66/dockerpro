pipeline {
    agent any
    envirnoments {
        DOCKERHUB_USER = credential ("docker_credential")
        DOCKERHUB_PASS = credential ("docker_credential")
        IMAGE_NAME = 'shivam193/hh:77'
    }
    stages{
        stage('checkout') {
            step {
                checkout scm
            }
        }
        stage('docker build & push') {
            step{
                bat 'echo %DOCKERHUB_PASS% | docker login -u %DOCKERHUB_USER --password-stdin'
                bat 'docker build -t %DOCKERHUB_USER%/%IMAGE_NAME% .'
                bat 'docker push %DOCKERHUB_USER%/%IMAGE_NAME%'
            }

        }
        stage('deploy') {
         step {
            bat 'kubectl apply -f deployment.yml'
         }
        }
     }
    }
